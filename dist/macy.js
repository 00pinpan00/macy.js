!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Macy=n()}(this,function(){"use strict";function t(t){var n=document.body.clientWidth,e={columns:t.columns},o=void 0;m(t.margin)?e.margin={x:t.margin.x,y:t.margin.y}:e.margin={x:t.margin,y:t.margin};for(var r=Object.keys(t.breakAt),i=r.length-1;i>=0;i--){var s=parseInt(r[i],10);n<=s&&(o=t.breakAt[s],m(o)||(e.columns=o),m(o)&&o.columns&&(e.columns=o.columns),m(o)&&o.margin&&!m(o.margin)&&(e.margin={x:o.margin,y:o.margin}),m(o)&&o.margin&&m(o.margin)&&o.margin.x&&(e.margin.x=o.margin.x),m(o)&&o.margin&&m(o.margin)&&o.margin.y&&(e.margin.y=o.margin.y))}return e}function n(n){return t(n).columns}function e(n){return t(n).margin}function o(t){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=n(t),i=e(t).x,s=100/r;return o?1===r?"100%":(i=(r-1)*i/r,"calc("+s+"% - "+i+"px)"):s}function r(t,r){var i=n(t.options),s=0,a=void 0,c=void 0;return 1===++r?0:(c=e(t.options).x,a=(c-(i-1)*c/i)*(r-1),s+=o(t.options,!1)*(r-1),"calc("+s+"% + "+a+"px)")}function i(t){for(var n=0,e=t.container,o=t.rows,r=o.length-1;r>=0;r--)n=o[r]>n?o[r]:n;e.style.height=n+"px"}function s(t,o){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=n(t.options),c=e(t.options).y;v(t,a,r),o.forEach(function(n){var e=0,o=parseInt(n.offsetHeight,10);isNaN(o)||(t.rows.forEach(function(n,o){n<t.rows[e]&&(e=o)}),n.style.position="absolute",n.style.top=t.rows[e]+"px",n.style.left=""+t.cols[e],t.rows[e]+=isNaN(o)?0:o+c,s&&(n.dataset.macyComplete=1))}),s&&(t.tmpRows=null),i(t)}function a(t,o){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=n(t.options),c=e(t.options).y;v(t,a,r),o.forEach(function(n){t.lastcol===a&&(t.lastcol=0);var e=p(n,"height");e=parseInt(n.offsetHeight,10),isNaN(e)||(n.style.position="absolute",n.style.top=t.rows[t.lastcol]+"px",n.style.left=""+t.cols[t.lastcol],t.rows[t.lastcol]+=isNaN(e)?0:e+c,t.lastcol+=1,s&&(n.dataset.macyComplete=1))}),s&&(t.tmpRows=null),i(t)}function c(t,n){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return E(n,function(){return t.emit(t.constants.EVENT_IMAGE_LOAD)},function(){return t.emit(t.constants.EVENT_IMAGE_COMPLETE)});E(n,null,function(){return t.emit(t.constants.EVENT_IMAGE_COMPLETE)})}function u(t,n){var e=void 0;return function(){e&&clearTimeout(e),e=setTimeout(t,n)}}function l(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function h(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.getOwnPropertyNames(Array.prototype).forEach(function(t){"length"!==t&&(NodeList.prototype[t]=Array.prototype[t],HTMLCollection.prototype[t]=Array.prototype[t])});var f=function t(n,e){if(!(this instanceof t))return new t(n,e);if(n=n.replace(/^\s*/,"").replace(/\s*$/,""),e)return this.byCss(n,e);for(var o in this.selectors)if(e=o.split("/"),new RegExp(e[1],e[2]).test(n))return this.selectors[o](n);return this.byCss(n)};f.prototype.byCss=function(t,n){return(n||document).querySelectorAll(t)},f.prototype.selectors={},f.prototype.selectors[/^\.[\w\-]+$/]=function(t){return document.getElementsByClassName(t.substring(1))},f.prototype.selectors[/^\w+$/]=function(t){return document.getElementsByTagName(t)},f.prototype.selectors[/^\#[\w\-]+$/]=function(t){return document.getElementById(t.substring(1))};var m=function(t){return t===Object(t)&&"[object Array]"!==Object.prototype.toString.call(t)},p=function(t,n){return window.getComputedStyle(t,null).getPropertyValue(n)},v=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.lastcol||(t.lastcol=0),t.rows.length<1&&(e=!0),e){t.rows=[],t.cols=[],t.lastcol=0;for(var o=n-1;o>=0;o--)t.rows[o]=0,t.cols[o]=r(t,o)}if(t.tmpRows){t.rows=[];for(var o=n-1;o>=0;o--)t.rows[o]=t.tmpRows[o]}else{t.tmpRows=[];for(var o=n-1;o>=0;o--)t.tmpRows[o]=t.rows[o]}},y=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n?t.container.children:f(':scope > *:not([data-macy-complete="1"])',t.container),i=o(t.options);return r.forEach(function(t){n&&(t.dataset.macyComplete=0),t.style.width=i}),t.options.trueOrder?(a(t,r,n,e),t.emit(t.constants.EVENT_RECALCULATED)):(s(t,r,n,e),t.emit(t.constants.EVENT_RECALCULATED))},d=function(t,n){setTimeout(function(){var e=t();n&&n(e)},0)},g=function(t,n,e){t&&d(t),e.req===e.complete&&d(n)},E=function(t,n,e){var o=t.length,r=0;t.forEach(function(t){t.complete&&(r++,g(n,e,{req:o,complete:r})),t.addEventListener("load",function(){r++,g(n,e,{req:o,complete:r})})})},w=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),A=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l(this,t),this.events=[],this.running=!1,this.add(n)}return w(t,[{key:"run",value:function(){if(this.events.length>0&&!this.running){var t=this.events.shift();this.running=!0,t(),this.running=!1,this.run()}}},{key:"add",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!!n&&(Array.isArray(n)?n.forEach(function(n){return t.add(n)}):(this.events.push(n),void this.run()))}},{key:"clear",value:function(){this.events=[]}}]),t}(),I=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),T=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h(this,t),this.events={},this.instance=n}return I(t,[{key:"on",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!(!t||!n)&&(Array.isArray(this.events[t])||(this.events[t]=[]),this.events[t].push(n))}},{key:"emit",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!n||!Array.isArray(this.events[n]))return!1;this.events[n].forEach(function(n){return n(t.instance)})}}]),t}(),b=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},N={columns:4,margin:2,trueOrder:!0,waitForImages:!1,useImageLoader:!0,breakAt:{},useOwnImageLoader:!1},L=function t(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;if(!(this instanceof t))return new t(e);if(this.options={},b(this.options,N,e),this.container=f(e.container),this.queue=new A,this.events=new T(this),this.container instanceof f||!this.container)return!!e.debug&&console.error("Error: Container not found");delete this.options.container,this.container.length&&(this.container=this.container[0]),this.container.style.position="relative",this.rows=[];var o=f("img",this.container);this.resizer=u(function(){n.emit(n.constants.EVENT_RESIZE),n.queue.add(function(){return n.recalculate(!0,!0)})},100),window.addEventListener("resize",this.resizer),this.on(this.constants.EVENT_IMAGE_LOAD,function(){return n.recalculate(!1,!1)}),this.on(this.constants.EVENT_IMAGE_COMPLETE,function(){return n.recalculate(!0,!0)}),e.useOwnImageLoader||c(this,o,!e.waitForImages),this.emit(this.constants.EVENT_INITIALIZED)};return L.init=function(t){return console.warn("Depreciated: Macy.init will be removed in v3.0.0 opt to use Macy directly like so Macy({ /*options here*/ }) "),new L(t)},L.prototype.recalculateOnImageLoad=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return c(this,f("img",this.container),!t)},L.prototype.runOnImageLoad=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=f("img",this.container);return this.on(this.constants.EVENT_IMAGE_COMPLETE,t),n&&this.on(this.constants.EVENT_IMAGE_LOAD,t),c(this,e,n)},L.prototype.recalculate=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e&&this.queue.clear(),this.queue.add(function(){return y(t,n,e)})},L.prototype.remove=function(){window.removeEventListener("resize",this.resizer),this.container.children.forEach(function(t){t.removeAttribute("data-macy-complete"),t.removeAttribute("style")}),this.container.removeAttribute("style")},L.prototype.reInit=function(){this.recalculate(!0,!0),this.emit(this.constants.EVENT_INITIALIZED),window.addEventListener("resize",this.resizer)},L.prototype.on=function(t,n){this.events.on(t,n)},L.prototype.emit=function(t){this.events.emit(t)},L.prototype.constants={EVENT_INITIALIZED:"macy.initialized",EVENT_RECALCULATED:"macy.recalculated",EVENT_IMAGE_LOAD:"macy.images.load",EVENT_IMAGE_COMPLETE:"macy.images.complete",EVENT_RESIZE:"macy.resize"},L});
