!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Macy=e()}(this,function(){"use strict";function t(t){var e=document.body.clientWidth,n={columns:t.columns},r=void 0;p(t.margin)?n.margin={x:t.margin.x,y:t.margin.y}:n.margin={x:t.margin,y:t.margin};for(var o=Object.keys(t.breakAt),i=o.length-1;i>=0;i--){var s=parseInt(o[i],10);e<=s&&(r=t.breakAt[s],p(r)||(n.columns=r),p(r)&&r.columns&&(n.columns=r.columns),p(r)&&r.margin&&!p(r.margin)&&(n.margin={x:r.margin,y:r.margin}),p(r)&&r.margin&&p(r.margin)&&r.margin.x&&(n.margin.x=r.margin.x),p(r)&&r.margin&&p(r.margin)&&r.margin.y&&(n.margin.y=r.margin.y))}return n}function e(e){return t(e).columns}function n(e){return t(e).margin}function r(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=e(t),i=n(t).x,s=100/o;return r?1===o?"100%":(i=(o-1)*i/o,"calc("+s+"% - "+i+"px)"):s}function o(t,o){var i=e(t.options),s=0,a=void 0,c=void 0;return 1===++o?0:(c=n(t.options).x,a=(c-(i-1)*c/i)*(o-1),s+=r(t.options,!1)*(o-1),"calc("+s+"% + "+a+"px)")}function i(t){for(var e=0,n=t.container,r=t.rows,o=r.length-1;o>=0;o--)e=r[o]>e?r[o]:e;n.style.height=e+"px"}function s(t,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e(t.options),c=n(t.options).y;y(t,a,o),r.forEach(function(e){var n=0,r=parseInt(e.offsetHeight,10);isNaN(r)||(t.rows.forEach(function(e,r){e<t.rows[n]&&(n=r)}),e.style.position="absolute",e.style.top=t.rows[n]+"px",e.style.left=""+t.cols[n],t.rows[n]+=isNaN(r)?0:r+c,s&&(e.dataset.macyComplete=1))}),s&&(t.tmpRows=null),i(t)}function a(t,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e(t.options),c=n(t.options).y;y(t,a,o),r.forEach(function(e){t.lastcol===a&&(t.lastcol=0);var n=m(e,"height");n=parseInt(e.offsetHeight,10),isNaN(n)||(e.style.position="absolute",e.style.top=t.rows[t.lastcol]+"px",e.style.left=""+t.cols[t.lastcol],t.rows[t.lastcol]+=isNaN(n)?0:n+c,t.lastcol+=1,s&&(e.dataset.macyComplete=1))}),s&&(t.tmpRows=null),i(t)}function c(t,e){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return E(e,function(){return t.emit(t.constants.EVENT_IMAGE_LOAD)},function(){return t.emit(t.constants.EVENT_IMAGE_COMPLETE)});E(e,null,function(){return t.emit(t.constants.EVENT_IMAGE_COMPLETE)})}function u(t,e){var n=void 0;return function(){n&&clearTimeout(n),n=setTimeout(t,e)}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.getOwnPropertyNames(Array.prototype).forEach(function(t){"length"!==t&&(NodeList.prototype[t]=Array.prototype[t],HTMLCollection.prototype[t]=Array.prototype[t])});var f=function t(e,n){if(!(this instanceof t))return new t(e,n);if(e=e.replace(/^\s*/,"").replace(/\s*$/,""),n)return this.byCss(e,n);for(var r in this.selectors)if(n=r.split("/"),new RegExp(n[1],n[2]).test(e))return this.selectors[r](e);return this.byCss(e)};f.prototype.byCss=function(t,e){return(e||document).querySelectorAll(t)},f.prototype.selectors={},f.prototype.selectors[/^\.[\w\-]+$/]=function(t){return document.getElementsByClassName(t.substring(1))},f.prototype.selectors[/^\w+$/]=function(t){return document.getElementsByTagName(t)},f.prototype.selectors[/^\#[\w\-]+$/]=function(t){return document.getElementById(t.substring(1))};var p=function(t){return t===Object(t)&&"[object Array]"!==Object.prototype.toString.call(t)},m=function(t,e){return window.getComputedStyle(t,null).getPropertyValue(e)},y=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.lastcol||(t.lastcol=0),t.rows.length<1&&(n=!0),n){t.rows=[],t.cols=[],t.lastcol=0;for(var r=e-1;r>=0;r--)t.rows[r]=0,t.cols[r]=o(t,r)}if(t.tmpRows){t.rows=[];for(var r=e-1;r>=0;r--)t.rows[r]=t.tmpRows[r]}else{t.tmpRows=[];for(var r=e-1;r>=0;r--)t.tmpRows[r]=t.rows[r]}},v=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=e?t.container.children:f(':scope > *:not([data-macy-complete="1"])',t.container),i=r(t.options);return o.forEach(function(t){e&&(t.dataset.macyComplete=0),t.style.width=i}),t.options.trueOrder?(a(t,o,e,n),t.emit(t.constants.EVENT_RECALCULATED)):(s(t,o,e,n),t.emit(t.constants.EVENT_RECALCULATED))},d=function(t,e){setTimeout(function(){var n=t();e&&e(n)},0)},g=function(t,e,n){t&&d(t),n.req===n.complete&&d(e)},E=function(t,e,n){var r=t.length,o=0;t.forEach(function(t){t.complete&&(o++,g(e,n,{req:r,complete:o})),t.addEventListener("load",function(){o++,g(e,n,{req:r,complete:o})})})},w=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),A=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l(this,t),this.events=[],this.running=!1,this.add(e)}return w(t,[{key:"run",value:function(){if(this.events.length>0&&!this.running){var t=this.events.shift();this.running=!0,t(),this.running=!1,this.run()}}},{key:"add",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!!e&&(Array.isArray(e)?e.forEach(function(e){return t.add(e)}):(this.events.push(e),void this.run()))}},{key:"clear",value:function(){this.events=[]}}]),t}(),b=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),I=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h(this,t),this.events={},this.instance=e}return b(t,[{key:"on",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!(!t||!e)&&(Array.isArray(this.events[t])||(this.events[t]=[]),this.events[t].push(e))}},{key:"emit",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e||!Array.isArray(this.events[e]))return!1;this.events[e].forEach(function(e){return e(t.instance)})}}]),t}(),T=function(){try{document.createElement("a").querySelector(":scope *")}catch(t){!function(){function t(t){return function(n){if(n&&e.test(n)){var r=this.getAttribute("id");r||(this.id="q"+Math.floor(9e6*Math.random())+1e6),arguments[0]=n.replace(e,"#"+this.id);var o=t.apply(this,arguments);return null===r?this.removeAttribute("id"):r||(this.id=r),o}return t.apply(this,arguments)}}var e=/:scope\b/gi,n=t(Element.prototype.querySelector);Element.prototype.querySelector=function(t){return n.apply(this,arguments)};var r=t(Element.prototype.querySelectorAll);Element.prototype.querySelectorAll=function(t){return r.apply(this,arguments)}}()}},N=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},L={columns:4,margin:2,trueOrder:!0,waitForImages:!1,useImageLoader:!0,breakAt:{},useOwnImageLoader:!1},_=function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L;if(!(this instanceof t))return new t(n);if(T(),this.options={},N(this.options,L,n),this.container=f(n.container),this.queue=new A,this.events=new I(this),this.container instanceof f||!this.container)return!!n.debug&&console.error("Error: Container not found");delete this.options.container,this.container.length&&(this.container=this.container[0]),this.container.style.position="relative",this.rows=[];var r=f("img",this.container);this.resizer=u(function(){e.emit(e.constants.EVENT_RESIZE),e.queue.add(function(){return e.recalculate(!0,!0)})},100),window.addEventListener("resize",this.resizer),this.on(this.constants.EVENT_IMAGE_LOAD,function(){return e.recalculate(!1,!1)}),this.on(this.constants.EVENT_IMAGE_COMPLETE,function(){return e.recalculate(!0,!0)}),n.useOwnImageLoader||c(this,r,!n.waitForImages),this.emit(this.constants.EVENT_INITIALIZED)};return _.init=function(t){return console.warn("Depreciated: Macy.init will be removed in v3.0.0 opt to use Macy directly like so Macy({ /*options here*/ }) "),new _(t)},_.prototype.recalculateOnImageLoad=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return c(this,f("img",this.container),!t)},_.prototype.runOnImageLoad=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=f("img",this.container);return this.on(this.constants.EVENT_IMAGE_COMPLETE,t),e&&this.on(this.constants.EVENT_IMAGE_LOAD,t),c(this,n,e)},_.prototype.recalculate=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n&&this.queue.clear(),this.queue.add(function(){return v(t,e,n)})},_.prototype.remove=function(){window.removeEventListener("resize",this.resizer),this.container.children.forEach(function(t){t.removeAttribute("data-macy-complete"),t.removeAttribute("style")}),this.container.removeAttribute("style")},_.prototype.reInit=function(){this.recalculate(!0,!0),this.emit(this.constants.EVENT_INITIALIZED),window.addEventListener("resize",this.resizer)},_.prototype.on=function(t,e){this.events.on(t,e)},_.prototype.emit=function(t){this.events.emit(t)},_.prototype.constants={EVENT_INITIALIZED:"macy.initialized",EVENT_RECALCULATED:"macy.recalculated",EVENT_IMAGE_LOAD:"macy.images.load",EVENT_IMAGE_COMPLETE:"macy.images.complete",EVENT_RESIZE:"macy.resize"},_});
